package org.apache.jsp.content;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;
import repository.InmueblesRepository;

public final class detallepropiedad_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent {

  private static final JspFactory _jspxFactory = JspFactory.getDefaultFactory();

  private static java.util.List<String> _jspx_dependants;

  private org.glassfish.jsp.api.ResourceInjector _jspx_resourceInjector;

  public java.util.List<String> getDependants() {
    return _jspx_dependants;
  }

  public void _jspService(HttpServletRequest request, HttpServletResponse response)
        throws java.io.IOException, ServletException {

    PageContext pageContext = null;
    HttpSession session = null;
    ServletContext application = null;
    ServletConfig config = null;
    JspWriter out = null;
    Object page = this;
    JspWriter _jspx_out = null;
    PageContext _jspx_page_context = null;

    try {
      response.setContentType("text/html;charset=UTF-8");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;
      _jspx_resourceInjector = (org.glassfish.jsp.api.ResourceInjector) application.getAttribute("com.sun.appserv.jsp.resource.injector");

      out.write("\n");
      out.write("\n");
      out.write("<!DOCTYPE html>\n");
      out.write("<html>\n");
      out.write("    <head>\n");
      out.write("\n");
      out.write("        ");
      org.apache.jasper.runtime.JspRuntimeLibrary.include(request, response, "includes/headIncludes.html", out, false);
      out.write("\n");
      out.write("\n");
      out.write("        <title>Ver en detalle</title>\n");
      out.write("\n");
      out.write("        <script type=\"text/javascript\">\n");
      out.write("            function ajaxLocalidades(provincia)\n");
      out.write("            {\n");
      out.write("\n");
      out.write("                $(\"#select2-chosen-2\").html(\"Cargando localidades...\");\n");
      out.write("                $.ajax({\n");
      out.write("                    type: 'POST',\n");
      out.write("                    url: \"/RealStateManager/GetLocalidadesServlet\",\n");
      out.write("                    data: \"provincia=\" + provincia,\n");
      out.write("                    dataType: 'html',\n");
      out.write("                    success: function (data) {\n");
      out.write("                        $(\"#localidad\").empty();\n");
      out.write("                        $(\"#localidad\").html(data);\n");
      out.write("                        $('#localidad option')[0].selected = true;\n");
      out.write("                        $(\"#select2-chosen-2\").html($('#localidad option:selected').val());\n");
      out.write("                        $('#promocion option')[0].selected = true;\n");
      out.write("                        $(\"#select2-chosen-3\").html($('#promocion option:selected').val());\n");
      out.write("                        $('#tipo_inmueble option')[0].selected = true;\n");
      out.write("                        $(\"#select2-chosen-4\").html($('#tipo_inmueble option:selected').val());\n");
      out.write("                    }\n");
      out.write("                });\n");
      out.write("            }\n");
      out.write("            function ajaxPromociones(localidad)\n");
      out.write("            {\n");
      out.write("                $(\"#select2-chosen-3\").html(\"Cargando promociones...\");\n");
      out.write("                $.ajax({\n");
      out.write("                    type: 'POST',\n");
      out.write("                    url: \"/RealStateManager/GetPromocionesServlet\",\n");
      out.write("                    data: \"provincia=\" + $('#provincia').val() + \"&localidad=\" + localidad,\n");
      out.write("                    dataType: 'html',\n");
      out.write("                    success: function (data) {\n");
      out.write("                        $(\"#promocion\").empty();\n");
      out.write("                        $(\"#promocion\").html(data);\n");
      out.write("                        $('#promocion option')[0].selected = true;\n");
      out.write("                        $(\"#select2-chosen-3\").html($('#promocion option:selected').val());\n");
      out.write("                        $('#tipo_inmueble option')[0].selected = true;\n");
      out.write("                        $(\"#select2-chosen-4\").html($('#tipo_inmueble option:selected').val());\n");
      out.write("                    }\n");
      out.write("                });\n");
      out.write("            }\n");
      out.write("\n");
      out.write("\n");
      out.write("\n");
      out.write("            function ajaxTiposInmueble(promocion)\n");
      out.write("            {\n");
      out.write("                $(\"#select2-chosen-4\").html(\"Cargando tipos de inmueble...\");\n");
      out.write("                $.ajax({\n");
      out.write("                    type: 'POST',\n");
      out.write("                    url: \"/RealStateManager/GetTiposInmuebleServlet\",\n");
      out.write("                    data: \"provincia=\" + $('#provincia').val() + \"&localidad=\" + $('#localidad').val() + \"&promocion=\" + promocion,\n");
      out.write("                    dataType: 'html',\n");
      out.write("                    success: function (data) {\n");
      out.write("                        $(\"#tipo_inmueble\").empty();\n");
      out.write("                        $(\"#tipo_inmueble\").html(data);\n");
      out.write("                        $('#tipo_inmueble option')[0].selected = true;\n");
      out.write("                        $(\"#select2-chosen-4\").html($('#tipo_inmueble option:selected').val());\n");
      out.write("                    }\n");
      out.write("                });\n");
      out.write("            }\n");
      out.write("\n");
      out.write("\n");
      out.write("\n");
      out.write("            function sendForm()\n");
      out.write("            {\n");
      out.write("\n");
      out.write("                provincia = $('#provincia').val();\n");
      out.write("                if (provincia === \"\" || provincia === null)\n");
      out.write("                {\n");
      out.write("                    alert(\"Por favor seleccione por lo menos una provincia para realizar la búsqueda...\");\n");
      out.write("                    return false;\n");
      out.write("                }\n");
      out.write("\n");
      out.write("                $(\"#tablaInmueblesDiv\").html(\"<h1><span class='label label-info'>Cargando el listado de inmuebles,espere un momento...</span></h1>\");\n");
      out.write("                var url = \"GetInmueblesServlet\"; // the script where you handle the form input.\n");
      out.write("                $.ajax({\n");
      out.write("                    type: \"POST\",\n");
      out.write("                    url: url,\n");
      out.write("                    data: $(\"#formFilter\").serialize(), // serializes the form's elements.\n");
      out.write("                    success: function (data)\n");
      out.write("                    {\n");
      out.write("                        $(\"#tablaInmueblesDiv\").empty();\n");
      out.write("                        $(\"#tablaInmueblesDiv\").html(data);\n");
      out.write("                        $('#tablaInmuebles').DataTable();\n");
      out.write("                        initialize();\n");
      out.write("                        return false; // avoid to execute the actual submit of the form.\n");
      out.write("                    }\n");
      out.write("                });\n");
      out.write("                return false; // avoid to execute the actual submit of the form.\n");
      out.write("            }\n");
      out.write("            function initMap()\n");
      out.write("            {\n");
      out.write("                return;\n");
      out.write("            }\n");
      out.write("            function initialize()\n");
      out.write("            {   \n");
      out.write("                \n");
      out.write("                 $(\"#mapaDiv\").html(\"<h1><span class='label label-info'>Cargando mapa correspondiente...</span></h1>\");\n");
      out.write("                $.ajax({\n");
      out.write("                    type: \"POST\",\n");
      out.write("                    url: \"GenerarMapaServlet\",\n");
      out.write("                    data: $(\"#formFilter\").serialize(), // serializes the form's elements.\n");
      out.write("                    success: function (data)\n");
      out.write("                    {\n");
      out.write("                        $(\"#mapaDiv\").empty();\n");
      out.write("                        //data is a string with all the information of the properties\n");
      out.write("                        //each property is separated by || and each attribute by ##\n");
      out.write("                        var map;\n");
      out.write("                        var markers = [];\n");
      out.write("                        var inmuebles = [];\n");
      out.write("                        inmuebles = data.split(\"||\"); //get each property with its fields,the \n");
      out.write("                        for (var i = 0; i < inmuebles.length - 1; i++) {\n");
      out.write("                            //EL MICROOOOO\n");
      out.write("                            //Now we separate the attributes into a single property\n");
      out.write("                            //the attributes are: id,coordinates (lat long),m2 built\n");
      out.write("                            var inmueble = [];\n");
      out.write("                            inmueble = inmuebles[i].split(\"##\");\n");
      out.write("                            //coordinates are separated by a space\n");
      out.write("                            var coorLatLng = [];\n");
      out.write("                            coorLatLng = inmueble[1].split(\" \");\n");
      out.write("                            var latLng;\n");
      out.write("                            if (i === 0)\n");
      out.write("                            {\n");
      out.write("                                //set the center to the first property\n");
      out.write("                                var center = new google.maps.LatLng(parseFloat(coorLatLng[0]), parseFloat(coorLatLng[1]));\n");
      out.write("                                latLng = new google.maps.LatLng(parseFloat(coorLatLng[0]), parseFloat(coorLatLng[1]));\n");
      out.write("                                map = new google.maps.Map(document.getElementById('mapaDiv'), {\n");
      out.write("                                    zoom: 10,\n");
      out.write("                                    center: center,\n");
      out.write("                                    title: 'Inmuebles',\n");
      out.write("                                    mapTypeId: google.maps.MapTypeId.ROADMAP\n");
      out.write("                                });\n");
      out.write("                            }\n");
      out.write("                            latLng = new google.maps.LatLng(parseFloat(coorLatLng[0]), parseFloat(coorLatLng[1]));\n");
      out.write("\n");
      out.write("                            var marker = new google.maps.Marker({\n");
      out.write("                                position: latLng,\n");
      out.write("                                title : \"Ref Inm.:\"+inmueble[0]+\"\\nSuperficie:\"+inmueble[2]\n");
      out.write("                            });\n");
      out.write("                            markers.push(marker);\n");
      out.write("\n");
      out.write("                        }\n");
      out.write("                        var markerCluster = new MarkerClusterer(map, markers);\n");
      out.write("                    }\n");
      out.write("                });\n");
      out.write("            }\n");
      out.write("\n");
      out.write("            function cleanForm()\n");
      out.write("            {\n");
      out.write("                $('#provincia option')[0].selected = true;\n");
      out.write("                $(\"#select2-chosen-1\").html($('#provincia option:selected').val());\n");
      out.write("                $(\"#localidad\").empty();\n");
      out.write("                $(\"#localidad\").html(\"<option value=''></option>\");\n");
      out.write("                $(\"#select2-chosen-2\").html(\"\");\n");
      out.write("                $(\"#promocion\").empty();\n");
      out.write("                $(\"#promocion\").html(\"<option value=''></option>\");\n");
      out.write("                $(\"#select2-chosen-3\").html(\"\");\n");
      out.write("                $(\"#tipo_inmueble\").empty();\n");
      out.write("                $(\"#tipo_inmueble\").html(\"<option value=''></option>\");\n");
      out.write("                $(\"#select2-chosen-4\").html(\"\");\n");
      out.write("            }\n");
      out.write("            $(document).ready(function () {\n");
      out.write("                $('select').select2();\n");
      out.write("            });</script>\n");
      out.write("\n");
      out.write("    </head>\n");
      out.write("\n");
      out.write("    <body>\n");
      out.write("        ");
 InmueblesRepository repo = new InmueblesRepository(); 
      out.write("\n");
      out.write("\n");
      out.write("        <div class=\"container\">\n");
      out.write("            <div class=\"navbar navbar-default navbar-fixed-top\" role=\"navigation\">\n");
      out.write("                <div class=\"navbar-header\">\n");
      out.write("                    <button type=\"button\" class=\"navbar-toggle\" data-toggle=\"collapse\" data-target=\".navbar-collapse\">\n");
      out.write("                        <span class=\"sr-only\">Toggle navigation</span>\n");
      out.write("                        <span class=\"icon-bar\"></span>\n");
      out.write("                        <span class=\"icon-bar\"></span>\n");
      out.write("                        <span class=\"icon-bar\"></span>\n");
      out.write("                    </button>\n");
      out.write("\n");
      out.write("                </div> \n");
      out.write("                <div class=\"navbar-collapse collapse\">\n");
      out.write("                    <a class=\"navbar-brand\" href=\"index.jsp\"><i class=\"fa fa-list-alt\"></i></i> Listado</a>\n");
      out.write("                    <a class=\"navbar-brand\" href=\"#\"><i class=\"fa fa-search\"></i>Búsqueda por referencia</a>\n");
      out.write("                    <a class=\"navbar-brand\" href=\"#\"><i class=\"fa fa-search-plus\"></i>Búsqueda Libre</a>\n");
      out.write("                    <a class=\"navbar-brand\" href=\"#\"><i class=\"fa fa-map-o\"></i> Ver Mapa</a>\n");
      out.write("\n");
      out.write("                </div><!--/.nav-collapse -->\n");
      out.write("            </div>\n");
      out.write("\n");
      out.write("            <form role=\"form\" type=\"Post\" id=\"formFilter\" name=\"formFilter\" action=\"javascript:void(0);\">\n");
      out.write("                <div class=\"row form-group\">\n");
      out.write("                    <div class=\"col-md-12 col-sm-12 col-xs-12\">\n");
      out.write("                        <div class=\"panel panel-default\">\n");
      out.write("                            <div class=\"panel-heading clearfix\">\n");
      out.write("                                <i class=\"icon-calendar\"></i>\n");
      out.write("                                <h3 class=\"panel-title\">Búsqueda</h3>\n");
      out.write("                            </div>\n");
      out.write("\n");
      out.write("                            <div class=\"panel-body\">\n");
      out.write("                                <div class=\" col-md-3 col-sm-6 col-xs-12 \">\n");
      out.write("                                    <label for=\"provincia\" >Provincia</label>\n");
      out.write("\n");
      out.write("                                    <select id=\"provincia\" name=\"provincia\" class=\"form-control\" onChange=\"ajaxLocalidades(this.value);\">\n");
      out.write("                                        ");
for (String provincia : repo.getProvincies()) {
      out.write("\n");
      out.write("                                        <option value=\"");
out.print(provincia);
      out.write('"');
      out.write('>');
out.print(provincia);
      out.write("</option>\n");
      out.write("                                        ");
}
      out.write("\n");
      out.write("                                    </select>\n");
      out.write("                                </div>\n");
      out.write("                                <div class=\" col-md-3 col-sm-6 col-xs-12\">\n");
      out.write("                                    <label for=\"localidad\">Localidad</label>\n");
      out.write("                                    <select class=\"form-control\" id=\"localidad\" name=\"localidad\" onChange=\"ajaxPromociones(this.value);\">\n");
      out.write("\n");
      out.write("                                    </select>\n");
      out.write("                                </div>\n");
      out.write("\n");
      out.write("                                <div class=\" col-md-3 col-sm-6 col-xs-12\">\n");
      out.write("                                    <label for=\"promocion\">Promocion</label>\n");
      out.write("                                    <select class=\"form-control\" name=\"promocion\" id=\"promocion\" onChange=\"ajaxTiposInmueble(this.value);\">\n");
      out.write("                                        <option value=\"\"></option>\n");
      out.write("                                    </select>\n");
      out.write("                                </div>\n");
      out.write("                                <div class=\" col-md-3 col-sm-6 col-xs-12\">\n");
      out.write("                                    <label for=\"tipo_inmueble\">Tipo de inmueble</label>\n");
      out.write("                                    <select class=\"form-control\" name=\"tipo_inmueble\" id=\"tipo_inmueble\">\n");
      out.write("                                        <option value=\"\"></option>\n");
      out.write("                                    </select>\n");
      out.write("                                </div>\n");
      out.write("                                <div class=\"col-md-12 col-sm-12 col-xs-12 \">\n");
      out.write("                                    <div class=\"col-md-12 col-sm-12 col-xs-12\">\n");
      out.write("                                        <button name=\"limpiar\"  class=\"btn btn-warning glyphicon glyphicon-trash pull-right margin-top-10\" onclick=\"cleanForm();\">LIMPIAR</button>\n");
      out.write("                                        <button name=\"mostrar\"  class=\"btn btn-success glyphicon glyphicon-hand-up pull-right margin-top-10  margin-right-20\" onclick=\"sendForm();\">BUSCAR</button>\n");
      out.write("                                    </div>\n");
      out.write("                                </div>\n");
      out.write("\n");
      out.write("                            </div>\n");
      out.write("                        </div>\n");
      out.write("                    </div>\n");
      out.write("            </form>\n");
      out.write("            <div class=\"row\" >\n");
      out.write("                <div id=\"tablaInmueblesDiv\" name=\"tablaInmueblesDiv\" class=\"col-md-12 col-sm-12 col-xs-12\"></div>\n");
      out.write("            </div>\n");
      out.write("            <div class=\"row height-map margin-top-20\" >\n");
      out.write("                <div id=\"mapaDiv\" name=\"mapaDiv\" class=\"height-map\" ></div>\n");
      out.write("            </div>\n");
      out.write("\n");
      out.write("\n");
      out.write("        </div>\n");
      out.write("    </body>\n");
      out.write("</html>");
    } catch (Throwable t) {
      if (!(t instanceof SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          out.clearBuffer();
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}
